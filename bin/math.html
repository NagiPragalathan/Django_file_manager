<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKEditor with Math Formulas</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
</head>
<body>
    <p>
        From the overview docs, in MathML: Let's consider <math><mi>a</mi><mo>â‰ </mo><mn>0</mn></math>.
    </p>
    <p>
        With \(\LaTeX\) input:
        When \(a \ne 0\), there are two solutions to \(ax^2 + bx + c = 0\) and they are
        $$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$
    </p>
    <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
        <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
            <div class="p-6 bg-white border-b border-gray-200">
                <form method="POST">
                    <textarea name="editor2" id="editor2" class="border-2 border-gray-500"></textarea>
                </form>
                <button id="editMath" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-4">Edit Math</button>
            </div>
        </div>
    </div>
    <div class="max-w-7xl mx-auto sm:px-6 lg:px-8" id="content2">
        <div style="padding: 23px;" class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
            <p>The number of <code>change</code> events: <strong><span id="changes"></span></strong>.</p>
            <h3>Mirrored Content</h3>The definition of the Euler-Mascheroni constant is
            $\gamma=\lim_{n\to\infty}\left(\sum_{k=1}^n\frac1k-ln(n)\right) $
            <hr style="border-top-width: 1px; margin-top: 14px;">
            <div id="editorcontent2" class="p-6 bg-white border-b border-gray-200"></div>
        </div>
    </div>

    <!-- Edit Math Modal -->
    <div id="mathModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="modal-content bg-white p-6 rounded shadow-md">
            <textarea id="mathEditor" class="border-2 border-gray-500 w-full"></textarea>
            <button id="cancelMath" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded mt-4 ml-2">Cancel</button>
        </div>
    </div>

    <script>
        var changesCount = 0;
        var editor_obj = []

        var editor2 = CKEDITOR.replace('editor2', {
            removePlugins: 'sourcearea',
            removeButtons: 'PasteFromWord',
            filebrowserBrowseUrl: '/apps/ckfinder/3.4.5/ckfinder.html',
            filebrowserImageBrowseUrl: '/apps/ckfinder/3.4.5/ckfinder.html?type=Images',
            filebrowserUploadUrl: '/apps/ckfinder/3.4.5/core/connector/php/connector.php?command=QuickUpload&type=Files',
            filebrowserImageUploadUrl: '/apps/ckfinder/3.4.5/core/connector/php/connector.php?command=QuickUpload&type=Images',
            removeButtons: 'PasteFromWord'
        });
        editor_obj.push(editor2)

    
        editor_obj[0].on('change', function (ev) {
            changesCount++;
            document.getElementById('content2').style.display = '';
            document.getElementById('changes').innerHTML = changesCount.toString();
            document.getElementById('editorcontent2').innerHTML = editor2.getData();
            MathJax.typeset();  // Trigger MathJax typesetting
        });
    
        document.getElementById('editMath').addEventListener('click', function() {
            // Open the Math Modal
            document.getElementById('mathModal').classList.remove('hidden');
    
            // Set the MathJax content to the modal editor
            var mathContent = document.getElementById('editor2').value;
            document.getElementById('mathEditor').value = mathContent;
        });
    
        document.getElementById('mathEditor').addEventListener('input', function() {
            // Get the edited content from the modal editor
            var editedContent = document.getElementById('mathEditor').value;
    
            // Update CKEditor dynamically while typing
            editor2.setData(editedContent);
            MathJax.typeset();  // Trigger MathJax typesetting
        });
    
        document.getElementById('cancelMath').addEventListener('click', function() {
            // Close the Math Modal without saving
            document.getElementById('mathModal').classList.add('hidden');
        });
    </script>
    
</body>
</html>
